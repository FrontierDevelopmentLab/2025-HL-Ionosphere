program: run.py
project: Ionosphere
method: bayes

metric:
  name: valid/rmse
  goal: minimize

# Let Hyperband prune weak configs quickly; "iterations" â‰ˆ your logged train steps.
early_terminate:
  type: hyperband
  min_iter: 400
  eta: 3

# Keep fixed run context here; sweep overrides come from "parameters" below.
command:
  - ${env}
  - python
  - ${program}
  - --mode
  - train
  - --model_type
  - SphericalFourierNeuralOperatorModel
  - --device
  - cuda
  - --data_dir
  - /mnt/disks/disk-main-data-1
  - --target_dir
  - /mnt/disks/disk-main-data-1/sfno_sweep_vertnoisefix/{wandb_run_id}
  - --date_start
  - '2019-03-01T00:00:00'
  - --date_end
  - '2020-05-01T00:00:00'
  - --celestrak_file_name
  - celestrak/kp_ap_processed_timeseries.csv
  - --set_file_name
  - set/karman-2025_data_sw_data_set_sw.csv
  - --delta_minutes
  - "15"
  - --date_dilation
  - "8"
  - --epochs
  - "3"
  - --batch_size
  - "4"
  - --weight_decay
  - "1e-6"
  - --num_workers
  - "8"
  - --context_window
  - "6"
  - --prediction_window
  - "2"
  - --spectral_backend
  - sht
  - --jpld_weight
  - "1.0"
  - --aux_weight
  - "0.3"
  - --valid_every_nth_epoch
  - "1"
  - --eval_mode
  - all
  - --no_eval
  - --wandb_mode
  - online
  # (Tip: omit a fixed --wandb_run_name so each agent gets a unique name)

parameters:
  # ---------- Core training ----------
  learning_rate:
    distribution: log_uniform_values
    min: 0.000008
    max: 0.0003
  weight_decay:
    distribution: log_uniform_values
    min: 0.000000005
    max: 0.00005
  batch_size:
    values: [2, 4, 8]
  epochs:
    values: [3, 4]              # short for fast signal; Hyperband prunes duds
  num_workers:
    values: [4, 8]
  date_dilation:
    values: [6, 8, 12]          # speed lever with decent sample diversity
  delta_minutes:
    values: [15, 30]
  dropout:
    values: [0.10, 0.20, 0.30]

  # ---------- Sequence windows (quality vs speed) ----------
  context_window:
    values: [4, 6, 8]
  prediction_window:
    values: [1, 2]

  # ---------- Spectral backend & capacity ----------
  spectral_backend:
    values: ["rfft", "sht"]     # rfft is cheap for exploration; sht for fidelity
  sfno_width:
    values: [64, 80]
  sfno_depth:
    values: [6, 8]
  sfno_modes_lat:
    values: [32, 48]
  sfno_modes_lon:
    values: [64, 96]
  n_sunlocked_heads:
    values: [180, 360]

  # ---------- Positional encoding & routing ----------
  n_harmonics:
    values: [1, 2]
  mc_dropout:
    values: [true, false]
  head_blend_sigma:
    values: [1.5, 2.0, 2.5]

  # ---------- Loss scaling & auxiliaries ----------
  jpld_weight:
    values: [0.8, 1.0, 2.0]
  aux_weight:
    values: [0.1, 0.2, 0.3]

  # ---------- Anti-stripe / smoothing controls ----------
  area_weighted_loss:
    values: [false, true]
  head_smooth_reg:
    values: [0.0, 1.0e-4, 3.0e-4]
  lon_tv_reg:
    values: [0.0, 5.0e-6, 2.0e-5]
  lon_highfreq_reg:
    values: [0.0, 1.0e-6, 5.0e-6]
  lon_highfreq_kmin:
    values: [72, 96, 120]
  lon_blur_sigma_deg:
    values: [0.0, 3.0, 5.0]
